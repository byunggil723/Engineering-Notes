# TCP

### TCP Header

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Source Port         | Destination Port     |
+---------------------+----------------------+
| Sequence Number                            |
+--------------------------------------------+
| Acknowledgment Number                      |
+--------------------------------------------+
| DataOffset | Reserved | Flags | Window     |
+--------------------------------------------+
| Checksum            | Urgent Pointer       |
+--------------------------------------------+
| Options (if any) ... (padding to 4B)       |
+--------------------------------------------+
| Data (payload)                             |
+--------------------------------------------+

Flags bits: [CWR ECE URG ACK PSH RST SYN FIN]

```

### TCP 3-way handshake

1\) Client → Server : SYN (Seq=1000)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=50887      | Dst Port=80          |
+---------------------+----------------------+
| Sequence Number = 1000                     |
+--------------------------------------------+
| Acknowledgment Number = (unused)           |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDc|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 0 bytes                   |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(0) PSH(0) RST(0) SYN(1) FIN(0)]

```

2\) Server → Client : SYN-ACK (Seq=50000, Ack=1001)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=80         | Dst Port=50887       |
+---------------------+----------------------+
| Sequence Number = 50000                    |
+--------------------------------------------+
| Acknowledgment Number = 1001               |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDs|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 0 bytes                   |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(1) PSH(0) RST(0) SYN(1) FIN(0)]

```

3\) Client → Server : ACK (Seq=1001, Ack=50001)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=50887      | Dst Port=80          |
+---------------------+----------------------+
| Sequence Number = 1001                     |
+--------------------------------------------+
| Acknowledgment Number = 50001              |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDc|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 0 bytes                   |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(1) PSH(0) RST(0) SYN(0) FIN(0)]

```

4\) Client → Server : Send 1460B data (Seq=1001, Ack=50001)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=50887      | Dst Port=80          |
+---------------------+----------------------+
| Sequence Number = 1001                     |
+--------------------------------------------+
| Acknowledgment Number = 50001              |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDc|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 1460 bytes                |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(1) PSH(0) RST(0) SYN(0) FIN(0)]

```

5\) Server → Client : Send 50B data and ACK (Seq=50001, Ack=2461)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=80         | Dst Port=50887       |
+---------------------+----------------------+
| Sequence Number = 50001                    |
+--------------------------------------------+
| Acknowledgment Number = 2461               |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDs|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 50 bytes                  |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(1) PSH(0) RST(0) SYN(0) FIN(0)]

```

6\) Client → Server : ACK (Seq=2461, Ack=50051)

```
TCP Header (min 20B)

0                   15 16                   31
+---------------------+----------------------+
| Src Port=50887      | Dst Port=80          |
+---------------------+----------------------+
| Sequence Number = 2461                     |
+--------------------------------------------+
| Acknowledgment Number = 50051              |
+--------------------------------------------+
| DataOffset=5 | Res=0 | Flags | Window=RWNDc|
+--------------------------------------------+
| Checksum = ...        | Urgent Pointer = 0 |
+--------------------------------------------+
| Options (if any) ... (예: MSS 등)           |
+--------------------------------------------+
| Data (payload) = 0 bytes                   |
+--------------------------------------------+

Flags bits: [CWR(0) ECE(0) URG(0) ACK(1) PSH(0) RST(0) SYN(0) FIN(0)]

```

### TCP Window

TCP 헤더의 `Window`는 송신 측이 수신 측에게 현재 Ack 기준으로 추가로 얼마만큼 더 보내도 되는지 알려주는 값이다.

예를 들어 클라이언트가 서버로부터 Ack=2461, Seq=50051, Window=10000인 세그먼트를 받았다면,<br>
이는 클라이언트가 서버에게 이후로 Ack=2461부터 최대 10000바이트까지 추가 전송할 수 있음을 의미한다. (즉, 가능한 Ack 범위는 2461 ~ 12460)<br>
따라서 클라이언트는 Data=2000을 보내도 아직 8000바이트의 여유가 남아 있으므로, 해당 2000바이트에 대한 ACK를 기다리지 않고 윈도우 범위 내 다음 데이터 전송을 계속 진행할 수 있다.
